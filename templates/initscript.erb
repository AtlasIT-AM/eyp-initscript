#!/bin/bash
# chkconfig: 345 20 99
# description: <%= @description %>
#. /etc/rc.d/init.d/functions
# Default-Start: 3 5
# Default-Stop: 0 6

<% if @option_scripts.any? -%>
<% @option_scripts.each do |val| -%>
. <%= val %> > /dev/null 2>&1
<% end -%>
<% end -%>

PIDFILE=/var/run/generic.init.<%= @initscript %>.pid
CMD="<%= @cmd %>"

case $1 in
  'start')
    $CMD &
    echo $! > $PIDFILE
    exit 0
  ;;
  'stop')
  if [ -z "$(cat $PIDFILE)" ];
  then
    echo "stopped"
    exit 1
  else
    kill $(cat $PIDFILE)
    sleep 1
    kill -9 $(cat $PIDFILE)
    sleep 1
    rm $PIDFILE
    exit 0
  fi
  ;;
  'restart')
    $0 stop
    $0 start
  ;;
  'status')
    if [ -z "$(cat $PIDFILE 2>/dev/null)" ];
    then
      echo "stopped"
      exit 1
    else
      if [ $(ps -p $(cat $PIDFILE) | wc -l 2>/dev/null) -eq 2 ];
      then
        echo "running"
        exit 0
      else
        echo "stopped"
        exit 1
      fi
    fi
  ;;
  *)
  echo "$0 $1: WTF?"
  exit 1
  ;;
esac
